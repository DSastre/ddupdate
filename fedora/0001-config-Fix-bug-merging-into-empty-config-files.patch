From 5ec274f97dc409fa5ae0e8edbf43d5def62ec0e8 Mon Sep 17 00:00:00 2001
From: Alec Leamas <leamas.alec@gmail.com>
Date: Fri, 2 Feb 2018 19:03:33 +0100
Subject: [PATCH 1/3] config: Fix bug merging into empty config files.

---
 lib/ddupdate/config.py | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/lib/ddupdate/config.py b/lib/ddupdate/config.py
index 8b3a710..89bae87 100755
--- a/lib/ddupdate/config.py
+++ b/lib/ddupdate/config.py
@@ -245,14 +245,18 @@ def update_config(config, path):
     try:
         parser.read(path)
     except configparser.Error:
-        pass
-    else:
-        if "update" in parser:
-            for key in config:
-                parser['update'][key] = config[key]
-    header = '# Created by ddupdate-config at %s\n' % time.asctime()
+        parser.clear()
+    if 'update' not in parser:
+        parser['update'] = {}
+    if 'ip-version' not in config:
+        config['ip-version'] = 'v4'
+    if 'loglevel' not in config:
+        config['loglevel'] = 'info'
+    for key in config:
+        if key not in parser['update']:
+            parser['update'][key] = config[key]
     with tempfile.NamedTemporaryFile(delete=False, mode='w') as f:
-        f.write(header)
+        f.write('# Created by ddupdate-config at %s\n' % time.asctime())
         parser.write(f)
         if ('service-options' or 'address-options') not in parser:
             f.write(_CONFIG_TRAILER)
-- 
2.13.6

