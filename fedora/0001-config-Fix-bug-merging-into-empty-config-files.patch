From e0de27117004024fe876d4539607f64bc4c751c7 Mon Sep 17 00:00:00 2001
From: Alec Leamas <leamas.alec@gmail.com>
Date: Fri, 2 Feb 2018 19:03:33 +0100
Subject: [PATCH 1/3] config: Fix bug merging into empty config files.

---
 lib/ddupdate/config.py | 13 ++++++-------
 1 file changed, 6 insertions(+), 7 deletions(-)

diff --git a/lib/ddupdate/config.py b/lib/ddupdate/config.py
index 8b3a710..4275be6 100755
--- a/lib/ddupdate/config.py
+++ b/lib/ddupdate/config.py
@@ -245,14 +245,13 @@ def update_config(config, path):
     try:
         parser.read(path)
     except configparser.Error:
-        pass
-    else:
-        if "update" in parser:
-            for key in config:
-                parser['update'][key] = config[key]
-    header = '# Created by ddupdate-config at %s\n' % time.asctime()
+        parser.clear()
+    parser.setdefault('update', {})
+    parser['update'].setdefault('ip-version', 'v4')
+    parser['update'].setdefault('loglevel', 'info')
+    parser['update'].update(config)
     with tempfile.NamedTemporaryFile(delete=False, mode='w') as f:
-        f.write(header)
+        f.write('# Created by ddupdate-config at %s\n' % time.asctime())
         parser.write(f)
         if ('service-options' or 'address-options') not in parser:
             f.write(_CONFIG_TRAILER)
-- 
2.13.6

